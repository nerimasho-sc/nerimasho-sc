---
import "../styles/global.css";
import { Image } from "astro:assets";
import clubEmblem from "../assets/image/club_emblem.svg";

interface Props {
  title: string;
  description?: string;
}

const {
  title,
  description = "練馬小学校サッカークラブ（練馬小SC）の公式ホームページです。練馬小学校を拠点に活動する、1977年創立の歴史ある地域密着チームです。光が丘少年サッカー連盟に所属し、全学年を対象にサッカーを通じた健全な育成を目指しています。体験・見学のご案内もこちらから。",
} = Astro.props;

const pathname = new URL(Astro.request.url).pathname;
const base = import.meta.env.BASE_URL;

const isActive = (path: string) => {
  const normalizedPath = path.endsWith("/") ? path : `${path}/`;
  const normalizedPathname = pathname.endsWith("/") ? pathname : `${pathname}/`;
  return normalizedPathname === normalizedPath;
};
---

<!doctype html>
<html lang="ja">
  <head>
    <!-- Google Tag Manager -->
    <script is:inline>
      (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({ "gtm.start": new Date().getTime(), event: "gtm.js" });
        var f = d.getElementsByTagName(s)[0],
          j = d.createElement(s),
          dl = l != "dataLayer" ? "&l=" + l : "";
        j.async = true;
        j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
        f.parentNode.insertBefore(j, f);
      })(window, document, "script", "dataLayer", "GTM-KS4TCX6J");
    </script>
    <!-- End Google Tag Manager -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <meta name="robots" content="noindex, nofollow" />
    <link
      rel="icon"
      type="image/svg+xml"
      href={`${import.meta.env.BASE_URL}image/club_emblem.svg`}
    />
    <meta name="generator" content={Astro.generator} />
    <title>
      {title} | 練馬小学校サッカークラブ（練馬小SC）公式ホームページ
    </title>
    <meta name="description" content={description} />
    <meta property="og:type" content="website" />
    <meta
      property="og:url"
      content="https://nerimasho-sc.github.io/nerimasho-sc/"
    />
    <meta
      property="og:image"
      content="https://nerimasho-sc.github.io/nerimasho-sc/image/club_emblem.svg"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=Noto+Sans+JP:wght@100..900&display=swap"
      rel="stylesheet"
    />
  </head>
  <body class="min-h-screen flex flex-col font-sans">
    <!-- Google Tag Manager (noscript) -->
    <noscript
      ><iframe
        src="https://www.googletagmanager.com/ns.html?id=GTM-KS4TCX6J"
        height="0"
        width="0"
        style="display:none;visibility:hidden"></iframe></noscript
    >
    <!-- End Google Tag Manager (noscript) -->
    <header class="sticky top-0 z-50 bg-club-yellow text-club-blue shadow-md">
      <div
        class="container mx-auto px-4 py-3 flex justify-between items-center"
      >
        <a
          href={import.meta.env.BASE_URL}
          class="flex items-center gap-4 group"
        >
          <div class="w-12 h-12 md:w-14 md:h-14 flex-shrink-0">
            <Image
              src={clubEmblem}
              alt="エンブレム"
              class="w-full h-full object-contain drop-shadow-md"
              width={120}
              height={120}
              loading="eager"
            />
          </div>

          <div class="flex flex-col border-l-2 border-club-blue/20 pl-4 py-1">
            <span
              class="text-xl md:text-2xl font-black italic tracking-tighter leading-none text-club-blue"
            >
              NERIMASHO SC
            </span>
            <span
              class="text-[10px] md:text-xs font-bold text-club-blue/80 leading-none mt-1.5 uppercase tracking-widest"
            >
              練馬小学校サッカークラブ
            </span>
          </div>
        </a>
        <nav class="hidden md:flex gap-6 font-bold text-sm">
          <a
            href={`${base}about`}
            class={`hover:text-club-red transition-colors ${isActive(`${base}about`) ? "text-club-red" : ""}`}
            >初めての方へ</a
          >
          <a
            href={`${base}policy`}
            class={`hover:text-club-red transition-colors ${isActive(`${base}policy`) ? "text-club-red" : ""}`}
            >指導方針</a
          >
          <a
            href={`${base}schedule`}
            class={`hover:text-club-red transition-colors ${isActive(`${base}schedule`) ? "text-club-red" : ""}`}
            >練習日程</a
          >
          <a
            href={`${base}contact`}
            class={`hover:text-club-red transition-colors ${isActive(`${base}contact`) ? "text-club-red" : ""}`}
            >お問い合わせ</a
          >
        </nav>
        <button
          id="menu-open"
          class="md:hidden p-2"
          aria-label="メニューを開く"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-6 w-6"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 6h16M4 12h16m-7 6h7"></path>
          </svg>
        </button>
      </div>
    </header>

    <!-- モバイルメニューオーバーレイ -->
    <div
      id="mobile-menu"
      class="fixed inset-0 z-[100] bg-club-blue transform translate-x-full transition-transform duration-300 md:hidden"
    >
      <div class="flex flex-col h-full p-6 text-white text-center">
        <div class="flex justify-between items-center mb-12">
          <span class="text-xl font-black italic">MENU</span>
          <button id="menu-close" class="p-2" aria-label="メニューを閉じる">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="h-8 w-8"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </div>
        <nav class="flex flex-col gap-8 text-2xl font-black italic">
          <a
            href={base}
            class={`mobile-nav-link ${isActive(base) ? "text-club-yellow" : ""}`}
            >HOME</a
          >
          <a
            href={`${base}about`}
            class={`mobile-nav-link ${isActive(`${base}about`) ? "text-club-yellow" : ""}`}
            >初めての方へ</a
          >
          <a
            href={`${base}policy`}
            class={`mobile-nav-link ${isActive(`${base}policy`) ? "text-club-yellow" : ""}`}
            >指導方針</a
          >
          <a
            href={`${base}schedule`}
            class={`mobile-nav-link ${isActive(`${base}schedule`) ? "text-club-yellow" : ""}`}
            >練習日程</a
          >
          <a
            href={`${base}contact`}
            class={`mobile-nav-link ${isActive(`${base}contact`) ? "text-club-yellow" : ""}`}
            >お問い合わせ</a
          >
        </nav>
      </div>
    </div>

    <script>
      const menuOpen = document.getElementById("menu-open");
      const menuClose = document.getElementById("menu-close");
      const mobileMenu = document.getElementById("mobile-menu");
      const body = document.body;

      function toggleMenu() {
        mobileMenu?.classList.toggle("translate-x-full");
        body.style.overflow = mobileMenu?.classList.contains("translate-x-full")
          ? ""
          : "hidden";
      }

      menuOpen?.addEventListener("click", toggleMenu);
      menuClose?.addEventListener("click", toggleMenu);

      // リンクがクリックされたら閉じる
      document.querySelectorAll(".mobile-nav-link").forEach((link) => {
        link.addEventListener("click", toggleMenu);
      });
    </script>

    <main class="flex-grow">
      <slot />
    </main>

    <footer class="bg-club-black text-white py-8 mt-10">
      <div class="container mx-auto px-4">
        <div class="flex flex-col items-center gap-6">
          <nav
            class="flex flex-wrap justify-center gap-x-6 gap-y-2 font-bold text-sm"
          >
            <a
              href={`${import.meta.env.BASE_URL}about`}
              class="hover:text-club-yellow transition-colors">初めての方へ</a
            >
            <a
              href={`${import.meta.env.BASE_URL}policy`}
              class="hover:text-club-yellow transition-colors">指導方針</a
            >
            <a
              href={`${import.meta.env.BASE_URL}schedule`}
              class="hover:text-club-yellow transition-colors">練習日程</a
            >
            <a
              href={`${import.meta.env.BASE_URL}contact`}
              class="hover:text-club-yellow transition-colors">お問い合わせ</a
            >
          </nav>

          <p class="text-xs text-gray-400 font-medium">
            お問い合わせ：nerimasho.sc@gmail.com
          </p>

          <div class="w-full border-t border-gray-800 pt-4 text-center">
            <p class="text-[10px] text-gray-500 tracking-wider">
              &copy; {new Date().getFullYear()} Nerima Elementary School Soccer Club.
              All Rights Reserved.
            </p>
          </div>
        </div>
      </div>
    </footer>

    <!-- スマホ用固定CTAボタン -->
    <div class="md:hidden fixed bottom-6 right-6 z-50">
      <a
        href={`${import.meta.env.BASE_URL}contact`}
        class="bg-club-red text-white font-bold py-4 px-6 rounded-full shadow-2xl flex items-center gap-2"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-5 w-5"
          viewBox="0 0 20 20"
          fill="currentColor"
        >
          <path
            d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"
          ></path>
          <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"
          ></path>
        </svg>
        体験・見学申込
      </a>
    </div>
  </body>
</html>
